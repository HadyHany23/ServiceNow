<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body></body>
  <script>
    // LIBRARY MANAGEMENT SYSTEM
    let library = [];

    function addBook() {
      let title = prompt("Enter Book Title:");
      if (!title || title.trim() === "") {
        alert("Book title cannot be empty.");
        return;
      }

      let author = prompt("Enter Author Name:");
      if (!author || author.trim() === "") {
        alert("Author name cannot be empty.");
        return;
      }

      let copies = prompt("Enter Number of Copies:");
      copies = Number(copies);
      if (isNaN(copies) || copies <= 0) {
        alert("Copies must be a number greater than 0.");
        return;
      }

      for (let i = 0; i < library.length; i++) {
        if (
          library[i].title.toLowerCase() === title.trim().toLowerCase() &&
          library[i].author.toLowerCase() === author.trim().toLowerCase()
        ) {
          library[i].availableCopies += copies;
          alert("Book already exists. Copies updated successfully!");
          return;
        }
      }

      let book = {
        title: title.trim(),
        author: author.trim(),
        availableCopies: copies,
        borrowedCopies: 0,
        borrowCount: 0,
      };

      library.push(book);
      alert("New book added successfully!");
    }

    function borrowBook() {
      if (library.length === 0) {
        alert("Library is empty. No books available.");
        return;
      }

      let booktitle = prompt("Enter book title:");
      if (!booktitle || booktitle.trim() === "") {
        alert("Book title cannot be empty.");
        return;
      }

      let found = false;
      for (let i = 0; i < library.length; i++) {
        let book = library[i];
        if (booktitle.trim().toLowerCase() === book.title.toLowerCase()) {
          found = true;
          if (book.availableCopies > 0) {
            book.availableCopies--;
            book.borrowedCopies++;
            book.borrowCount++;
            alert("Book borrowed successfully!");
          } else {
            alert("No available copies to borrow.");
          }
          break;
        }
      }

      if (!found) {
        alert("Book not found in library.");
      }
    }

    function returnBook() {
      if (library.length === 0) {
        alert("Library is empty.");
        return;
      }

      let booktitle = prompt("Enter book title to return:");
      if (!booktitle || booktitle.trim() === "") {
        alert("Book title cannot be empty.");
        return;
      }

      let found = false;
      for (let i = 0; i < library.length; i++) {
        let book = library[i];
        if (booktitle.trim().toLowerCase() === book.title.toLowerCase()) {
          found = true;
          if (book.borrowedCopies > 0) {
            book.borrowedCopies--;
            book.availableCopies++;
            alert("Book returned successfully!");
          } else {
            alert("No borrowed copies to return.");
          }
          break;
        }
      }

      if (!found) {
        alert("Book not found in library.");
      }
    }

    function showReport() {
      if (library.length === 0) {
        console.log("Library is empty.");
        return;
      }

      let reportData = [];

      for (let i = 0; i < library.length; i++) {
        let book = library[i];

        let status;

        if (book.availableCopies > 2) {
          status = "Available";
        } else if (book.availableCopies >= 1) {
          status = "Limited";
        } else {
          status = "Out of Stock";
        }

        reportData.push({
          Title: book.title,
          Author: book.author,
          Available: book.availableCopies,
          Borrowed: book.borrowedCopies,
          BorrowedTimes: book.borrowCount,
          Status: status,
        });
      }

      console.log("LIBRARY REPORT");
      console.table(reportData);

      let totals = calculateTotalBooks();

      console.log("TOTAL SUMMARY");
      console.log("Total Available Copies:", totals.totalAvailable);
      console.log("Total Borrowed Copies:", totals.totalBorrowed);
    }

    function calculateTotalBooks() {
      let totalAvailable = 0;
      let totalBorrowed = 0;

      for (let i = 0; i < library.length; i++) {
        totalAvailable += library[i].availableCopies;
        totalBorrowed += library[i].borrowedCopies;
      }

      return {
        totalAvailable: totalAvailable,
        totalBorrowed: totalBorrowed,
      };
    }

    let menuechoice;

    do {
      menuechoice = prompt(
        "Library Management System\n" +
          "1 → Add New Book\n" +
          "2 → Borrow Book\n" +
          "3 → Return Book\n" +
          "4 → Show Library Report\n" +
          "5 → Exit\n" +
          "Enter your choice no:",
      );
      switch (menuechoice) {
        case "1":
          addBook();
          break;
        case "2":
          borrowBook();
          break;
        case "3":
          returnBook();
          break;
        case "4":
          showReport();
          break;
        case "5":
          alert("Exiting Library System. Goodbye!");
          showReport();
          break;
        default:
          alert("Invalid choice. Please try again.");
      }
    } while (menuechoice !== "5");
  </script>
</html>
